<!DOCTYPE html>
<html lang="en">
<head>
	<link rel="stylesheet" type="text/css" href="../static/main.css">
	<link rel="stylesheet" type="text/css" href="../static/weather-icons.css">
	<link rel="stylesheet" type="text/css" href="../static/weather-icons.min.css">
	<link rel="stylesheet" type="text/css" href="../static/weather-icons-wind.css">
	<link rel="stylesheet" type="text/css" href="../static/weather-icons-wind.min.css">
</head>
<body>
    <div class="container">
        <label id=locLabel>Enter Location</label>

        <div id="locationInput" class="input-group-lg center-block helloInput">
            <input id="location" type="text" placeholder="Enter Zipcode or City and State" value="36832" />
        </div>
				<label id="dateLabel">Enter Date (Optional)</label>
				<div id="dateContainer" class="input-group-lg center-block">
					<input type="date" id="dateInput" />
				</div>
				<label id="timeLabel">Enter Time (Optional)</label>
				<div id="timeContainer" class="input-group-lg center-block">
					<input type="time" id="timeInput" />
                </div>
				<div id="submitContainer" class="input-group-lg center-block">
					<input type="submit" id="submit" name="submit" value="Submit" />
				</div>
    </div>
    
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="../static/antixss.js" type="text/javascript"></script>
    <!--<script src="index.js" type="text/javascript"></script>-->

    <script>
    	//Submit data when enter key is pressed
        $('#submit').click(function() {
            console.log($('#map_hour').val());
			console.log("I DID IT");
			var datetime = new Date();
            var name = $('#location').val();
            var date = $('#dateInput').val();
			var time = $('#timeInput').val();
            if (name.length > 0) { //catch Enter key
                //POST request to API to create a new visitor entry in the database
                if (date != null && date.trim().length > 0){
									var dateSplit = date.split("-");
									datetime.setFullYear(parseInt(dateSplit[0]));
									datetime.setMonth(parseInt(dateSplit[1]));
									datetime.setMonth(parseInt(dateSplit[2]));
								}
						if (time != null && time.trim().length > 0) {
							var timeSplit = time.split(":");
							datetime.setHours(parseInt(timeSplit[0]));
							datetime.setMinutes(parseInt(timeSplit[1]));
							datetime.setSeconds(0);
							datetime.setMilliseconds(0);
						}
                console.log(datetime.getTime())
                $.ajax({
				    method: "POST",
				    url: "./api",
				    contentType: "application/json",
				    data: JSON.stringify({name: name, datetime: datetime.getTime()})
				    })
                    .done(function(json) {
                        render(json);
                });
            }
        });
        
        function render(json){
            data = JSON.parse(json); 
            var d = new Date(parseFloat(AntiXSS.sanitizeInput(data.time)*1000)); // The 0 there is the key, which sets the date to the epoch
            $('#time').html(d);
            $('#temp').html(AntiXSS.sanitizeInput(data.temperature) + '&deg;F');
            $('#humidity').html(parseFloat(AntiXSS.sanitizeInput(data.humidity)) * 100 + '% Hum');
            var precip = AntiXSS.sanitizeInput(data.precipType); 
            if (precip == 'undefined') precip = 'precipitation'; 
            $('#precip').html(parseFloat(AntiXSS.sanitizeInput(data.precipProbability)) * 100 + '% Chance of ' + precip);
			$('#intensity').html(parseFloat(AntiXSS.sanitizeInput(data.precipProbability)) * 100 + '% Intensity');
			$('#apparentTemp').html('Feels like ' + AntiXSS.sanitizeInput(data.apparentTemperature) + '&deg;F');
						var mapSource = 'https://darksky.net/map-embed/@temperature,' + data.latitude + ',' + data.longitude + ',4.js?embed=true&timeControl=true&fieldControl=true&defaultField=temperature&defaultUnits=_f';
						$('#mapscript').attr('src', mapSource);
        }
				
				$(document).ready(function() {
					$('.tab').click(function() {
						console.log('Clicked tab');
						if ($(this).hasClass('active')) {
							console.log('Detected class');
							$(this).removeClass('active');
							$('.tabcontent').css('display', 'none');
						} else {
							$('.tab').removeClass('active');
							$('.tabcontent').css('display', 'none');
							$(this).addClass('active');
							$(this).parent().children('.tabcontent').css('display', 'inline-block');
						}
					});
                });
                

        function insertGoogleScript() {
	        var google_api = document.createElement('script'),
			api_key    = 'AIzaSyBqMAS6VPFmEm9PKpvnN1ZxnQK3rIlgEW8';

	        google_api.src = 'https://maps.googleapis.com/maps/api/js?key='+ api_key +'&callback=initGoogleAPI&libraries=places,geometry';
	        document.body.appendChild(google_api);
        }


        // SearchBox Method
        function initGoogleAPI() {
	        var autocomplete = new google.maps.places.SearchBox(document.querySelector("#city-search"));
	        autocomplete.addListener('places_changed', function() {
		    var place = autocomplete.getPlaces()[0];
	    });
}
    </script>
		<div class="container map-container">
			<script id='mapscript' src='https://darksky.net/map-embed/@temperature,39.000,-95.000,4.js?embed=true&timeControl=true&fieldControl=true&defaultField=temperature&defaultUnits=_f'></script>
			<ul class="tablist">
				<li class="tab-container">
					<span class="tab"><i id="therm-icon" class="wi wi-thermometer"></i></span>
					<div class="tabcontent">
						<p id="temp">40&deg;F</p>
                        <p id="humidity">50% Hum.</p>
						<p id="apparentTemp">Feels like 40&deg;F</p>
					</div>
				</li>
				<li class="tab-container">
					<span class="tab"><i id="precip-icon" class="wi wi-rain"></i></span>
					<div class="tabcontent">
						<p id="summary">Cloudy</p>
						<p id="precip">22% Chance of Rain</p>
						<p id="intensity">87% Intensity</p>
						<p id="cloudCover">10% Cloud Cover</p>
						<p id="visibility">50% Visibility</p>
					</div>
				</li>
				<li class="tab-container">
					<span class="tab"><i id="wind-icon" class="wi wi-strong-wind"></i></span>
					<div class="tabcontent">
						<p id="windSpeed">10 MPH</p>
						<p id="windBearing">180</p>
					</div>
				</li>
			</ul>
			
			<p id="time">3:00 PM</p>
			
		</div>
</body>

</html>
